{{define "head"}}
{{end}}
{{define "body"}}
    <div class="card  bg-white rounded">
        <h5 class="card-header">发布文章</h5>
        <div class="card-body col-md-12 align-self-center">
            <form class="row g-3 needs-validation was-validated" id="f1" novalidate>
                <div class="col-md-12">
                    <label for="validationServer01" class="form-label">标题</label>
                    <input type="text" class="form-control is-valid" id="validationServer01" v-model="f1.title" required>
                </div>
                <div class="col-md-12">
                    <label for="validationServer01" class="form-label">内容</label>
                    <div id="f1-content"  v-html="f1.content" spellcheck="false"></div>
                </div>

                <div v-if="ajax_message != ''">${ajax_message}</div>
                <div class="col-12">
                    <button class="btn btn-primary" type="button" disabled v-if="wait_loading">
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Loading...
                    </button>
                    <button class="btn btn-primary" type="submit"  v-else  @click.prevent="submit($event)">登录</button>
                </div>

            </form>
        </div>
    </div>
{{end}}
{{define "js"}}
<script type="application/javascript" src="{{st "/wangEditor-3.1.1/jquery.min.js"}}"></script>
<script type="application/javascript" src="{{st "/wangEditor-3.1.1/wangEditor.min.js"}}"></script>
<script>
    var app = new Vue({
        el: '#vue-app',
        delimiters:['${','}'],
        data() {
            return {
                ajax_message:'',
                wait_loading:false,
                f1:{
                    'title':'',
                    'content':'',
                },
            }
        },
        created(){

        },
    })
</script>
<script type="text/javascript">
    const UploadServer = "{{.___upload_server}}";
    function getBase64Loca(img) {
        try {
            img.crossOrigin = "*";
            var c = document.createElement('canvas');

            c.height = img.naturalHeight;
            c.width = img.naturalWidth;
            var ctx = c.getContext('2d');
            ctx.drawImage(img, 0, 0, c.width, c.height);
            return  c.toDataURL();
        }catch (e) {
            return ""
        }
    }

    function imgToBase64() {
        document.querySelectorAll('img').forEach(function (v,k) {
           var now_src =  v.currentSrc;
           if(!now_src.startsWith(UploadServer)){
              // v.remove()
           }
        })
    }

    var E = window.wangEditor;
    var editor = new E('#f1-content');
    editor.customConfig.menus =
        [
            'head',  // 标题
            'bold',  // 粗体
            'fontSize',  // 字号
            'fontName',  // 字体
            // 'italic',  // 斜体
            // 'underline',  // 下划线
            'strikeThrough',  // 删除线
            'foreColor',  // 文字颜色
            'backColor',  // 背景颜色
            'link',  // 插入链接
            'list',  // 列表
            'justify',  // 对齐方式
            'quote',  // 引用
            // 'emoticon',  // 表情
            'image',  // 插入图片
            // 'table',  // 表格
            // 'video',  // 插入视频
            'code',  // 插入代码
            'undo',  // 撤销
            'redo'  // 重复
    ];

    // 使用 base64 保存图片
    // editor.customConfig.uploadImgShowBase64 = true;

    editor.customConfig.uploadImgServer = UploadServer +'/upload_img_123';
    editor.customConfig.uploadImgMaxLength = 1;
    editor.customConfig.uploadFileName = 'file';
    editor.customConfig.onchange = function (html) {
        // html 即变化之后的内容
        setTimeout(function () {
            imgToBase64()
        },20)

    };
    editor.customConfig.uploadImgHooks = {
        customInsert: function (insertImg, result, editor) {
            if (result.code !== 1){
                alert(result.message);
                return
            }
            var url = UploadServer + '/'+result.url;
            insertImg(url)
        }
    };
    editor.create();
</script>
{{end}}